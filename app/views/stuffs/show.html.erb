<div class="box main-panel">
	<%= render "shared/main_menu" %>

	<div class="main-container">
		<%= flash_message %>

		<div class="row">
			<div class="col">
				<header class="container-header">
					<h1 class="header-title">Detalhes do<span> equipamento</span></h1>

					<div class="actions">
						<%= link_to edit_stuff_path(@stuff), class: "btn-info icon" do %><span class="material-symbols-outlined md-16 md-light">edit</span>Editar dados<% end %>
						<%= link_to :back, class: "btn-cancel icon" do %><span class="material-symbols-outlined md-16">undo</span>Voltar<% end %>
						<%= link_to destroy_stuff_path(@stuff), method: :delete, data: { confirm: "Tem certeza? Essa ação é irreversível." }, class: "btn-alert icon" do %><span class="material-symbols-outlined md-16 md-light">close</span>Excluir equipamento<% end %>
		      </div>
				</header>
			</div>
		</div>

		<div class="row">
			<div class="col">
				<section class="container-body">
		  		<section>
		  			<h3 class="m-b-25">Dados do equipamento</h3>

		  			<%= content_tag :dl do %>
		    			<%= content_tag :dt, "Patrimônio" %>
		  				<%= content_tag :dd, @stuff.patrimony %>
		  			<% end %>

		  			<%= content_tag :dl do %>
		    			<%= content_tag :dt, "Categoria" %>
		  				<%= content_tag :dd, @stuff.category %>
		  			<% end %>

		  			<%= content_tag :dl do %>
		    			<%= content_tag :dt, "Marca/modelo" %>
		  				<%= content_tag :dd, @stuff.brand %>
		  			<% end %>

		  			<%= content_tag :dl do %>
		    			<%= content_tag :dt, "Equipamento está no padrão?" %>
		  				<%= content_tag :dd, @stuff.defaulted %>
		  			<% end %>

		  			<%= content_tag :dl do %>
		    			<%= content_tag :dt, "Unidade" %>
		    			<%= content_tag :dd do %>
		  					<%= link_to school_path(@stuff.school), class: "link flex" do %>
		  						<%= @stuff.school.name %> <span class="material-symbols-outlined md-16">open_in_new</span>
		  					<% end %>
		  				<% end %>
		  			<% end unless is_school?(current_user) %>
		  		</section>

		  		<section>
		  			<h3 class="m-b-25">Histórico</h3>

		  			<div class="row">
							<div class="col-12">
								<div class="card">
									<% unless @orders.nil? || @orders.blank? %>
										<div class="card-body">
											<ul class="responsive-table">
												<li class="table-header">
													<div class="table-col table-col-5">#</div>
													<div class="table-col table-col-10">Solicitante</div>
													<div class="table-col table-col-10">Status</div>
													<div class="table-col table-col-10">Tipo</div>
													<div class="table-col table-col-40">Defeito apresentado</div>
													<div class="table-col table-col-15">Atualizada em</div>
													<div class="table-col table-col-10"><div class="options">Opções</div></div>
												</li>

												<% @orders.order("created_at DESC").each do |o| %>
													<li class="table-row">
														<div class="table-col table-col-5" data-label="#"><strong><%= o.id.to_s.rjust(3, '0') %></strong></div>
														<div class="table-col table-col-10" data-label="Solicitante"><%= o.requester %></div>
														<div class="table-col table-col-10" data-label="Status" data-status="<%= get_status(o.status) %>"><%= o.status %></div>
														<div class="table-col table-col-10" data-label="Tipo"><%= o.o_type || " - " %></div>
														<div class="table-col table-col-40" data-label="Defeito apresentado">
															<div class="order-defect limited-text">
																<%= o.defect.to_s.html_safe %>
															</div>
														</div>
														<div class="table-col table-col-15" data-label="Atualizada em">
															<%= content_tag :span do %>
																<%= "#{o.updated_at.strftime("%d/%m/%Y")} por " %>
																<%= link_to order_creator(o.updated_by), is_school?(User.find(o.updated_by)) ? school_path(o.school_id) : user_path(o.updated_by), class: "link"  %><br />
																<%= o.updated_at.strftime("%H:%M") %>
															<% end %>
														</div>
														<div class="table-col table-col-10" data-label="Opções">
															<div class="options">
											          <%= link_to order_path(o), alt: "Ver detalhes", title: "Ver detalhes", class: "btn-icon" do %><span class="material-symbols-outlined md-20">visibility</span><% end %>
															</div>
														</div>
													</li>
												<% end %>
											</ul>

											<%= paginate @orders %>
										</div>
									<% else %>
										<h4 class="text-center m-t-25 p-b-50"><i>Nenhuma OS registrada para este equipamento.</i></h4>
									<% end %>
								</div>
							</div>
						</div>
		  		</section>
				</section>
			</div>
		</div>
	</div>
</div>
